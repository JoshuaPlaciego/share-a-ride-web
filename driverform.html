form.addEventListener('submit', function(e) {
  const start = document.getElementById('pickupStartTime').value;
  const end = document.getElementById('pickupEndTime').value;

  if (end <= start) {
    alert('Pickup end time must be after the start time.');
    e.preventDefault();
    return false;
  }

  e.preventDefault(); // prevent default submit to control flow
  submitBtn.disabled = true;

  loadingBarContainer.style.display = 'block';
  loadingBar.style.animation = 'none';
  void loadingBar.offsetWidth;
  loadingBar.style.animation = 'loadingAnimation 3s linear forwards';

  submitted = true;
  form.submit();  // submit with full values intact
});

document.getElementById('hidden_iframe').onload = function() {
  if (submitted) {
    alert('Driver info submitted successfully!');
    submitted = false;

    // Clear and enable fields AFTER successful submission
    [...form.elements].forEach(el => {
      if (el.tagName.toLowerCase() !== 'button') {
        el.value = '';
        el.disabled = false;
      }
    });
    submitBtn.disabled = false;
    loadingBarContainer.style.display = 'none';
  }
};
